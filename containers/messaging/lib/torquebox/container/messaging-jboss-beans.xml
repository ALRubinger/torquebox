<deployment xmlns="urn:jboss:bean-deployer:2.0">

   <!--
              Naming/RMI-related
     -->

  <bean name="RMIClassProviderExecutor" class="java.util.concurrent.ThreadPoolExecutor">
    <constructor factoryMethod="newFixedThreadPool" factoryClass="java.util.concurrent.Executors">
      <parameter>2</parameter>
    </constructor>
    <stop method="shutdown"/>
  </bean>

   <bean name="RMIClassProvider" class="org.torquebox.containers.web.WebServer">
     <property name="threadPool"><inject bean="RMIClassProviderExecutor"/></property>
     <install method="setJavaRmiServerCodebase" state="Installed"/>
   </bean>
   <!-- 
              HornetQ 
     -->

   <!-- The core configuration -->
   <bean name="Configuration" class="org.hornetq.core.config.impl.FileConfiguration">
      <property name="configurationUrl">${torquebox.hornetq.configuration.url}</property>
   </bean>

   <!-- MBean server -->
   <bean name="MBeanServer" class="javax.management.MBeanServer">
      <constructor factoryClass="java.lang.management.ManagementFactory"
                   factoryMethod="getPlatformMBeanServer"/>
   </bean> 

    <!-- The security manager -->
   <bean name="HornetQSecurityManager" class="org.hornetq.spi.core.security.HornetQSecurityManagerImpl">
      <start ignored="true"/>
      <stop ignored="true"/>
   </bean>

   <!-- The core server -->
   <bean name="HornetQServer" class="org.hornetq.core.server.impl.HornetQServerImpl">
      <constructor>
         <parameter>
            <inject bean="Configuration"/>
         </parameter>
         <parameter>
            <inject bean="MBeanServer"/>
         </parameter>
         <parameter>
            <inject bean="HornetQSecurityManager"/>
         </parameter>   
      </constructor>
      <start ignored="true"/>
      <stop ignored="true"/>   
   </bean>
   
   <bean name="JMSConfiguration" class="org.hornetq.jms.server.config.impl.JMSConfigurationImpl">
     <constructor>
       <parameter>
         <list>
           <bean name="ConnectionFactoryConfiguration" class="org.hornetq.jms.server.config.impl.ConnectionFactoryConfigurationImpl">
             <constructor>
               <parameter>ConnectionFactory</parameter>
               <parameter>ConnectionFactory</parameter>
             </constructor>
             <property name="connectorNames">
               <list>
                 <bean name="AnonPair" class="org.hornetq.api.core.Pair">
                   <constructor>
                     <parameter>netty</parameter>
                     <parameter><null/></parameter>
                   </constructor>
                 </bean>
               </list>
             </property>
           </bean>
         </list>
       </parameter>
       <parameter>
         <list/>
       </parameter>
       <parameter>
         <list/>
       </parameter>
     </constructor>
   </bean>

   <!-- The JMS server -->
   <bean name="JMSServerManager" class="org.hornetq.jms.server.impl.JMSServerManagerImpl">
      <constructor>         
         <parameter>
            <inject bean="HornetQServer"/>
         </parameter>         
         <parameter>
            <inject bean="JMSConfiguration"/>
         </parameter>         
      </constructor>
      <depends state="Started">RMIClassProvider</depends>
   </bean>

   <!-- 
              TorqueBox 
     -->

  <bean name="QueuesYamlParsingDeployer" class="org.torquebox.messaging.deployers.QueuesYamlParsingDeployer"/>
  <bean name="TopicsYamlParsingDeployer" class="org.torquebox.messaging.deployers.TopicsYamlParsingDeployer"/>

  <bean name="ManagedQueueDeployer" class="org.torquebox.messaging.deployers.ManagedQueueDeployer"/>
  <bean name="ManagedTopicDeployer" class="org.torquebox.messaging.deployers.ManagedTopicDeployer"/>
  
  <bean name="MessagingRbParsingDeployer" class="org.torquebox.messaging.deployers.MessagingRbParsingDeployer"/>
  <bean name="MessageProcessorDeployer" class="org.torquebox.messaging.deployers.MessageProcessorDeployer"/>
  
  <bean name="MessagingRuntimePoolDeployer" class="org.torquebox.messaging.deployers.MessagingRuntimePoolDeployer">
    <property name="instanceFactoryName">RubyRuntimeFactory</property>
  </bean>

</deployment>
